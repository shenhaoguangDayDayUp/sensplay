!function(){function e(e,t){return parseInt(e.style[t]||getComputedStyle(e,null).getPropertyValue(t))}function t(e,t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)}function i(e,i){e.classList?e.classList.add(i):t(e,i)||(e.className+=""+i)}function n(e,i){e.classList?e.classList.remove(i):t(e,i)&&(e.className=e.className.replace(new RegExp("(\\s|^)"+i+"(\\s|$)")," ").replace(/^\s+|\s+$/g,""))}function s(e,t){(!isFinite(e)||0>e)&&(e=0);var i=t.alwaysShowHours?[0]:[];return Math.floor(e/3600)%24&&i.push(Math.floor(e/3600)%24),i.push(Math.floor(e/60)%60),i.push(Math.floor(e%60)),i=i.join(":"),1==t.timeFormatType&&(i=i.replace(/(:|^)([0-9])(?=:|$)/g,"$10$2")),i}function o(){return document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen}function a(e){var t,i;switch(e=e.toLowerCase().split("?")[0],t=e.substring(e.lastIndexOf(".")+1),i=/mp4|m4v|ogg|ogv|m3u8|webm|webmv|wmv|mpeg|mov/gi.test(t)?"video/":"audio/",t){case"mp4":case"m4v":case"m4a":return i+"mp4";case"webm":case"webma":case"webmv":return i+"webm";case"ogg":case"oga":case"ogv":return i+"ogg";case"m3u8":return"application/x-mpegurl";case"ts":return i+"mp2t";default:return i+t}}function r(e,t){return e&&!t?a(e):t&&~t.indexOf(";")?t.substr(0,t.indexOf(";")):t}function l(e,t,i){var n,s,o,a=[];if(t.type)if("string"==typeof t.type)a.push({type:t.type,url:i});else for(n=0;n<t.type.length;n++)a.push({type:t.type[n],url:i});else if(null!==i)a.push({type:r(i,e.getAttribute("type")),url:i});else for(n=0;n<e.children.length;n++)s=e.children[n],1==s.nodeType&&"source"==s.tagName.toLowerCase()&&(i=s.getAttribute("src"),a.push({type:r(i,s.getAttribute("type")),url:i}));if(u.features.isBustedAndroid&&(e.canPlayType=function(e){return/video\/(mp4|m4v)/i.test(e)?"maybe":""}),u.features.isChromium&&(e.canPlayType=function(e){return/video\/(webm|ogv|ogg)/i.test(e)?"maybe":""}),u.features.supportsCanPlayType)for(n=0;n<a.length;n++)if("video/m3u8"==a[n].type||""!==e.canPlayType(a[n].type).replace(/no/,"")||""!==e.canPlayType(a[n].type.replace(/mp3/,"mpeg")).replace(/no/,"")||""!==e.canPlayType(a[n].type.replace(/m4a/,"mp4")).replace(/no/,"")){o=!0;break}return o}var d,u={};u.config={type:"",mediaTitle:"",nativeControls:!1,autoplay:!1,preload:"none",videoWidth:"100%",videoHeight:"auto",aspectRation:16/9,audioWidth:"100%",audioHeight:44,autoLoop:!1,timeFormatType:1,alwaysShowHours:!1,alwaysShowControls:!1,hideVideoControlsOnLoad:!1,enableFullscreen:!0,pauseOtherPlayers:!0,duration:0,success:null,error:null},function(e){var t=window.navigator.userAgent.toLowerCase(),i=document.createElement("video");e.isiOS=/iphone|ipod|ipad/i.test(t)&&!window.MSStream,e.isAndroid=/android/i.test(t)&&!window.MSStream,e.isBustedAndroid=/android 2\.[12]/i.test(t),e.isChromium=/chromium/i.test(t),e.hasTouch="ontouchstart"in window,e.supportsCanPlayType="undefined"!=typeof i.canPlayType,e.isVendorBigPlay=/iphone/i.test(t)&&!window.MSStream,e.isVendorControls=/baidu/i.test(t),e.isVendorFullscreen=/micromessenger|weibo/i.test(t),e.isVendorAutoplay=/v819mini/i.test(t)||e.isiOS,e.nativeFullscreenPrefix=function(){return i.requestFullScreen?"":i.webkitRequestFullScreen?"webkit":i.mozRequestFullScreen?"moz":i.msRequestFullScreen?"ms":"-"}(),e.hasOldNativeFullScreen="-"==e.nativeFullscreenPrefix&&i.webkitEnterFullscreen,e.hasOldNativeFullScreen&&/mac os x 10_5/i.test(t)&&(e.nativeFullscreenPrefix="-",e.hasOldNativeFullScreen=!1)}(u.features={}),d=0,u.players={},u.MediaPlayer=function(e,t){var i,n,s,o,a=this;if(!e.isInstantiated&&(e.isInstantiated=!0,a.media=e,n=a.media.tagName.toLowerCase(),/audio|video/.test(n))){a.isVideo="video"===n,a.options={};for(i in u.config)a.options[i]=u.config[i];try{for(i in t)a.options[i]=t[i];s=JSON.parse(a.media.getAttribute("data-config"));for(i in s)a.options[i]=s[i]}catch(r){}a.options.autoplay&&(a.options.autoplay=!u.features.isVendorAutoplay),a.isVideo||(a.options.alwaysShowControls=!0),a.options.nativeControls||u.features.isVendorControls?a.media.setAttribute("controls","controls"):(o=a.media.getAttribute("src"),o=""===o?null:o,l(a.media,a.options,o)?(a.id="zym_"+d++,u.players[a.id]=a,a.init()):alert("不支持此"+(a.isVideo?"视":"音")+"频"))}},u.MediaPlayer.prototype={isControlsVisible:!0,isFullScreen:!1,setPlayerSize:function(t){var i,n,s=this,o=e(s.container,"width");t>o&&(s.width=o),s.enableAutoSize&&(i=s.media.videoWidth,n=s.media.videoHeight,i&&n&&Math.abs(s.options.aspectRation-i/n)<.1&&(s.options.aspectRation=i/n),s.height=parseInt(o/s.options.aspectRation)),s.container.style.width=s.width+"px",s.media.style.height=s.container.style.height=s.height+"px"},showControls:function(){var e=this;e.isControlsVisible||(e.controls.style.bottom=0,e.options.mediaTitle&&(e.title.style.top=0),e.isControlsVisible=!0)},hideControls:function(){var e=this;e.isControlsVisible&&!e.options.alwaysShowControls&&(e.controls.style.bottom="-45px",e.options.mediaTitle&&(e.title.style.top="-35px"),e.isControlsVisible=!1)},setControlsTimer:function(e){var t=this;clearTimeout(t.controlsTimer),t.controlsTimer=setTimeout(function(){t.hideControls()},e)},updateTimeline:function(t){var i,n=this,s=void 0!==t?t.target:n.media,o=null,a=e(n.slider,"width");s.buffered&&s.buffered.length>0&&s.buffered.end&&s.duration?o=s.buffered.end(s.buffered.length-1)/s.duration:void 0!==s.bytesTotal&&s.bytesTotal>0&&void 0!==s.bufferedBytes?o=s.bufferedBytes/s.bytesTotal:t&&t.lengthComputable&&0!==t.total&&(o=t.loaded/t.total),null!==o&&(o=Math.min(1,Math.max(0,o)),n.loaded.style.width=a*o+"px",n.media.paused&&setTimeout(function(){n.loaded.style.width=a*o+"px",n.updateTimeline()},300)),void 0!==n.media.currentTime&&n.media.duration&&(i=Math.round(a*n.media.currentTime/n.media.duration),n.current.style.width=i+"px",n.handle.style.left=i-Math.round(e(n.handle,"width")/2)+"px")},updateTime:function(){var e=this;e.currentTime.innerHTML=s(e.media.currentTime,e.options),(e.options.duration>1||e.media.duration>1)&&(e.durationDuration.innerHTML=s(e.options.duration>1?e.options.duration:e.media.duration,e.options))},enterFullScreen:function(){var t=this;if(t.normalHeight=e(t.container,"height"),t.normalWidth=e(t.container,"width"),"-"!=u.features.nativeFullscreenPrefix)t.container[u.features.nativeFullscreenPrefix+"RequestFullScreen"]();else if(u.features.hasOldNativeFullScreen)return void t.media.webkitEnterFullscreen();i(document.documentElement,"zy_fullscreen"),t.media.style.width=t.container.style.width="100%",t.media.style.height=t.container.style.height="100%",i(t.fullscreenBtn,"zy_unfullscreen"),t.isFullScreen=!0},exitFullScreen:function(){var e=this;(o()||e.isFullScreen)&&("-"!=u.features.nativeFullscreenPrefix?document[u.features.nativeFullscreenPrefix+"CancelFullScreen"]():u.features.hasOldNativeFullScreen&&document.webkitExitFullscreen()),n(document.documentElement,"zy_fullscreen"),e.media.style.width=e.container.style.width=e.normalWidth+"px",e.media.style.height=e.container.style.height=e.normalHeight+"px",n(e.fullscreenBtn,"zy_unfullscreen"),e.isFullScreen=!1},buildContainer:function(){var t=this;t.container=t.media.parentNode,t.container.style.overflow="hidden",t.container.style.height=(t.isVideo?e(t.container,"width")/t.options.aspectRation:t.options.audioHeight)+"px",t.container.innerHTML='<div class="zy_wrap"></div><div class="zy_controls"></div>'+(t.options.mediaTitle?'<div class="zy_title">'+t.options.mediaTitle+"</div>":""),t.title=t.container.querySelector(".zy_title"),t.media.setAttribute("preload",t.options.preload),t.container.querySelector(".zy_wrap").appendChild(t.media),t.controls=t.container.querySelector(".zy_controls"),t.isVideo&&(t.width=t.options.videoWidth,t.height=t.options.videoHeight,"100%"==t.width&&"auto"==t.height&&(t.enableAutoSize=!0),t.setPlayerSize(t.width,t.height))},buildPlaypause:function(){function e(e){(t.media.isUserClick||t.options.autoplay)&&("play"===e?(n(s,"zy_play"),i(s,"zy_pause")):(n(s,"zy_pause"),i(s,"zy_play")))}var t=this,s=document.createElement("div");s.className="zy_playpause_btn zy_play",t.controls.appendChild(s),s.addEventListener("click",function(){t.media.isUserClick=!0,t.media.paused?(t.media.play(),t.media.paused||t.options.alwaysShowControls||t.setControlsTimer(3e3)):t.media.pause()}),t.media.addEventListener("play",function(){e("play")}),t.media.addEventListener("playing",function(){e("play")}),t.media.addEventListener("pause",function(){e("pse")}),t.media.addEventListener("paused",function(){e("pse")})},buildTimeline:function(){var t,i,n,o,a,r=this,l=document.createElement("div");l.className="zy_timeline",l.innerHTML='<div class="zy_timeline_slider"><div class="zy_timeline_buffering" style="display:none"></div><div class="zy_timeline_loaded"></div><div class="zy_timeline_current"></div><div class="zy_timeline_handle"></div></div>',r.controls.appendChild(l),r.slider=l.children[0],r.buffering=r.slider.children[0],r.loaded=r.slider.children[1],r.current=r.slider.children[2],r.handle=r.slider.children[3],t=!1,i=r.slider.offsetLeft,n=e(r.slider,"width"),o=e(r.handle,"width")/2,a=function(e){var a,l=0;a=e.changedTouches?e.changedTouches[0].pageX:e.pageX,r.media.duration&&(i>a?a=i:a>n+i&&(a=n+i),r.handle.style.left=a-o-i+"px",l=(a-i)/n*r.media.duration,r.currentTime.innerHTML=s(r.media.currentTime,r.options),t&&l!==r.media.currentTime&&(r.media.currentTime=l))},u.features.hasTouch?r.slider.addEventListener("touchstart",function(s){t=!0,a(s),i=r.slider.offsetLeft,n=e(r.slider,"width"),r.slider.addEventListener("touchmove",a),r.slider.addEventListener("touchend",function(){t=!1,r.slider.removeEventListener("touchmove",a)})}):r.slider.addEventListener("mousedown",function(s){t=!0,a(s),i=r.slider.offsetLeft,n=e(r.slider,"width"),r.slider.addEventListener("mousemove",a),r.slider.addEventListener("mouseup",function(){t=!1,r.slider.addEventListener("mousemove",a)})}),r.slider.addEventListener("mouseenter",function(){r.slider.addEventListener("mousemove",a)}),r.slider.addEventListener("mouseleave",function(){t||r.slider.removeEventListener("mousemove",a)}),r.media.addEventListener("timeupdate",function(e){r.updateTimeline(e)})},buildTime:function(){var e=this,t=document.createElement("div");t.className="zy_time",t.innerHTML='<span class="zy_currenttime">'+s(0,e.options)+'</span>/<span class="zy_duration">'+s(e.options.duration,e.options)+"</span>",e.controls.appendChild(t),e.currentTime=t.children[0],e.durationDuration=t.children[1],e.media.addEventListener("timeupdate",function(){e.updateTime()})},buildFullscreen:function(){var e,t=this;"-"!=u.features.nativeFullscreenPrefix&&(e=function(){t.isFullScreen&&(o()||t.exitFullScreen())},document.addEventListener(u.features.nativeFullscreenPrefix+"fullscreenchange",e)),t.fullscreenBtn=document.createElement("div"),t.fullscreenBtn.className="zy_fullscreen_btn",t.controls.appendChild(t.fullscreenBtn),t.fullscreenBtn.addEventListener("click",function(){"-"!=u.features.nativeFullscreenPrefix&&o()||t.isFullScreen?t.exitFullScreen():t.enterFullScreen()})},buildDec:function(){var e,t,i=this,n=document.createElement("div");n.className="dec_loading",n.style.display="none",i.container.appendChild(n),e=document.createElement("div"),e.className="dec_error",e.style.display="none",e.innerHTML="播放异常",i.container.appendChild(e),t=document.createElement("div"),u.features.isVendorBigPlay||(t.className="dec_play",i.container.appendChild(t),t.addEventListener("click",function(){i.media.isUserClick=!0,i.media.play(),i.media.paused||i.options.alwaysShowControls||i.setControlsTimer(3e3)})),i.media.addEventListener("play",function(){i.media.isUserClick&&(t.style.display="none",n.style.display="",i.buffering.style.display="none")}),i.media.addEventListener("playing",function(){t.style.display="none",n.style.display="none",i.buffering.style.display="none",e.style.display="none"}),i.media.addEventListener("seeking",function(){n.style.display="",t.style.display="none",i.buffering.style.display=""}),i.media.addEventListener("seeked",function(){n.style.display="none",i.buffering.style.display="none"}),i.media.addEventListener("pause",function(){t.style.display=""}),i.media.addEventListener("waiting",function(){n.style.display="",t.style.display="none",i.buffering.style.display=""}),i.media.addEventListener("error",function(s){n.style.display="none",t.style.display="",i.buffering.style.display="none",i.media.pause(),e.style.display="","function"==typeof i.options.error&&i.options.error(s)})},init:function(){var e,t=this,i=["Container","Playpause","Timeline","Time"];for(t.options.enableFullscreen&&!u.features.isVendorFullscreen&&t.isVideo&&i.push("Fullscreen"),t.isVideo&&i.push("Dec"),e=0;e<i.length;e++)try{t["build"+i[e]]()}catch(n){}t.isVideo&&(u.features.hasTouch?t.media.addEventListener("click",function(){t.isControlsVisible?t.hideControls():(t.showControls(),t.media.paused||t.options.alwaysShowControls||t.setControlsTimer(3e3))}):(t.media.addEventListener("click",function(){t.media.paused?t.media.play():t.media.pause()}),t.container.addEventListener("mouseenter",function(){t.showControls(),t.options.alwaysShowControls||t.setControlsTimer(3e3)}),t.container.addEventListener("mousemove",function(){t.showControls(),t.options.alwaysShowControls||t.setControlsTimer(3e3)})),t.options.hideVideoControlsOnLoad&&t.hideControls(),t.media.addEventListener("loadedmetadata",function(){t.enableAutoSize&&setTimeout(function(){isNaN(t.media.videoHeight)||t.setPlayerSize()},50)})),t.media.addEventListener("play",function(){var e,i;for(i in u.players)if(e=u.players[i],e.id!=t.id&&t.options.pauseOtherPlayers&&!e.paused&&!e.ended)try{e.media.pause()}catch(n){}}),window.addEventListener("orientationchange",function(){setTimeout(function(){t.setPlayerSize()},500)}),t.media.addEventListener("ended",function(e){t.media.currentTime=0,t.options.autoLoop?t.media.play():(t.isVideo&&setTimeout(function(){t.container.querySelector(".dec_loading").style.display="none"},20),t.media.pause()),t.updateTimeline(e)}),t.media.addEventListener("loadedmetadata",function(){t.updateTime()}),t.options.autoplay&&(t.media.isUserClick=!1,t.media.play()),"function"==typeof t.options.success&&t.options.success(t.media)}},window.zymedia=function(e,t){"string"==typeof e?[].forEach.call(document.querySelectorAll(e),function(e){new u.MediaPlayer(e,t)}):new u.MediaPlayer(e,t)}}();
//# sourceMappingURL=zy.media.min.js.map
